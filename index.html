<!DOCTYPE html>
<html>

<head>
    <title>Money Cars</title>
    <meta charset="UTF-8">
    <meta name='viewport' content='initial-scale=1, maximum-scale=1, user-scalable=0'>
    <link rel="icon" type="image/x-icon" href="/pics/icons/favicon.ico">
    <script src="experiments-platform.js"></script>
    <link rel="manifest" href="manifest.json">
    <script src='jquery.min.js'></script>
    <link href='addtohomescreen/style/style.css' rel='stylesheet'>



    <!--
            this is how to create the icon pack and manifest
            https://medium.com/@sam20gh/how-to-add-add-to-home-screen-to-your-website-4b07aee02676
            and this is why it can't be automated on all browsers (IOS for example)
            https://love2dev.com/pwa/add-to-homescreen-library/
        -->
    <!--
            this is how to check if app is standalone:
            https://stackoverflow.com/questions/41742390/javascript-to-check-if-pwa-or-mobile-web
         -->

    <!--
    pwa stuff-
    https://javascript.plainenglish.io/creating-a-browser-agnostic-pwa-install-button-41039f312fbe
    https://www.geeksforgeeks.org/making-a-simple-pwa-under-5-minutes/
-->
    <link rel="apple-touch-icon" sizes="57x57" href="pics/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="pics/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="pics/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="pics/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="pics/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="pics/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="pics/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="pics/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="pics/icons/apple-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="pics/icons/apple-icon-180x180.png">
    <link rel="apple-touch-icon" href="pics/icons/apple-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="pics/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="pics/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="pics/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="pics/icons/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="pics/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#000000">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Money Cars">
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="apple-mobile-web-app-status-bar" content="#aa7700">
    <meta name="theme-color" content="black">

    <link rel="apple-touch-startup-image" href="pics/Instructions/1.png">

    <div>
        <img id="installIns" ; src="pics/Instructions/installIns.png">
        <img src="pics/Instructions/installation_guide_Android.png" ; id="installAndroid">
        <img src="pics/Instructions/installation_guide_iOS.png" ; id="installIOS">
    </div>

    <div>
        <button type="button" id="notIphoneYellow"><img src="pics/Instructions/notIphoneYellow.png" width="100%"
                height="100%" /></button>
        <button type="button" id="iphoneYellow"><img src="pics/Instructions/IphoneYellow.png" width="100%"
                height="100%" /></button>

    </div>

    <script>
        document.getElementById("notIphoneYellow").addEventListener("click", function () {
            document.getElementById("installAndroid").style.display = "inline";
            document.getElementById("notIphoneYellow").style.display = "none";
            document.getElementById("iphoneYellow").style.display = "none";
        });
        document.getElementById("iphoneYellow").addEventListener("click", function () {
            document.getElementById("installIOS").style.display = "inline";
            document.getElementById("notIphoneYellow").style.display = "none";
            document.getElementById("iphoneYellow").style.display = "none";
        });
    </script>

    <script src="addtohomescreen/src/addtohomescreen.js"></script>


</head>

<body>

    <body id="body-element" class="bgInstallPage">
        <!-- App installation guide -->
        <!-- <img id="installation_guide" src="" />
        <div id="deviceDoesNotFit" style="width: 90%;" class="centered error_message hidden">
            <h2>יש להכנס לקישור זה מסמארטפון<br>(אייפון או אנדרואיד).</h2>
        </div> -->

        <!-- Loading Screen -->
        <!-- <div id="app_will_load_soon" class="centered appIsLoading">
            <h1>...טוען</h1>
        </div> -->

        <!-- iframe to run the app in -->
        <iframe id="iframe-element" src="." class="hidden"
            style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;">
            Your browser doesn't support iframes
        </iframe>

    </body>

    <script>

        if (
            (("standalone" in window.navigator) && !window.navigator.standalone) // for ios
            ||
            (!window.matchMedia('(disply-mode: standalone)').matches) //android
        ) {
            addToHomescreen()
        }

        // check if implemented as PWA:
        const ifPWAitr = setInterval(() => {
            var isInWebAppiOS = window.navigator.standalone === true;
            var isInWebAppChrome =
                window.matchMedia("(display-mode: fullscreen)").matches ||
                window.matchMedia("(display-mode: standalone)").matches ||
                window.matchMedia("(display-mode: minimal-ui)").matches

            // if app PWA:
            if (isInWebAppiOS || isInWebAppChrome) {
                // first, prevent multiple reloads:
                document.getElementById('iframe-element').onload = ''

                // load index.html with the relevant info (for the iframe):
                document.getElementById("installAndroid").style.display = "none";
                document.getElementById("installIns").style.display = "none";
                document.getElementById("installIOS").style.display = "none";
                document.getElementById("iphoneYellow").style.display = "none";
                document.getElementById("notIphoneYellow").style.display = "none";
                clearInterval(ifPWAitr);
                document.getElementById('iframe-element').src = "instructions/instructions.html";

                // show the app (which run through the iframe element):
                document.getElementById('iframe-element').classList.remove('hidden');
                document.getElementById('app_will_load_soon').classList.add('hidden');
                document.getElementById('loading_animation').classList.add('hidden');




                // if app isn't PWA show specific installation instructions:
            } else {
                document.getElementById('app_will_load_soon').classList.add('hidden');
                document.getElementById('loading_animation').classList.add('hidden');

                // Show installation instructions according to the device type:
                // var mobileOS = getMobileOperatingSystem();
                // if (mobileOS === 'iOS' || mobileOS === 'Android') {
                //     document.getElementById('installation_guide').setAttribute('src', 'pics/instructions/installation_guide_' + mobileOS + '.png')
                // } else {
                //     document.getElementById('deviceDoesNotFit').style.display = "none";;
                // }
            }
        }, 1000);


        // // get mobile func OS function:
        // function getMobileOperatingSystem() { // taken by Rani from https://stackoverflow.com/questions/21741841/detecting-ios-android-operating-system
        //     //     var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        //     // Windows Phone must come first because its UA also contains "Android"
        //     if ((/Mobi/.test(navigator.userAgent)) || (/Mobi|Android/i.test(navigator.userAgent))) {
        //         // mobile!
        //         if (/windows phone/i.test(userAgent)) {
        //             return "Windows Phone";
        //         }
        //         if (/android/i.test(userAgent)) {
        //             return "Android";
        //         }
        //         // iOS detection from: http://stackoverflow.com/a/9039885/177710
        //         if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        //             return "iOS";
        //         }
        //         return "unknown";
        //     }
        // }
    </script>


    <!-- MY STUFF-->
    <script>
    //     let prompt;
    //     window.addEventListener('beforeinstallprompt', function (e) {
    //         // Prevent the mini-infobar from appearing on mobile
    //         e.preventDefault();
    //         // Stash the event so it can be triggered later.
    //         prompt = e;
    //     });

    //     installButton.addEventListener('click', function () {
    //         prompt.prompt();
    //     })
    // </script>

    <script>
    //     let installed = false;
    //     installButton.addEventListener('click', async function () {
    //         prompt.prompt();
    //         let result = await that.prompt.userChoice;
    //         if (result && result.outcome === 'accepted') {
    //             installed = true;
    //             onMyFrameLoad();
    //             // window.location.href = 'instructions/instructions.html';

    //         }
    //     })

    //     window.addEventListener('appinstalled', async function (e) {
    //         installButton.style.display = "none";
    //     });
    // </script>


    <!-- Service Worker -->
    <script>
        window.addEventListener('load', () => {
            registerSW();
        });

        // Register the Service Worker
        async function registerSW() {
            if ('serviceWorker' in navigator) {
                try {
                    await navigator
                        .serviceWorker
                        .register('serviceworker.js');
                }
                catch (e) {
                    console.log('SW registration failed');
                }
            }
        }
    </script>


    <script>
        // check if the app is instalabe:
        let installable = true;
        if (!('serviceWorker' in navigator)) {
            installable = false;
            console.log('app not loading... RELOADING page')
        }
    </script>



</body>

</html>